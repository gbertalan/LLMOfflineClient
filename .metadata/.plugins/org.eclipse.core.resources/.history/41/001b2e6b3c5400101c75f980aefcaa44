import javax.swing.*;
import javax.swing.text.html.HTMLEditorKit;
import javax.swing.text.html.StyleSheet;
import java.awt.*;

public class MarkdownDisplayPanel extends JPanel {
    private final JEditorPane editorPane;
    
    public MarkdownDisplayPanel() {
        setLayout(new BorderLayout());
        
        // Create editor pane with HTML support
        editorPane = new JEditorPane();
        editorPane.setContentType("text/html");
        editorPane.setEditable(false);
        
        // Configure HTML rendering
        HTMLEditorKit kit = new HTMLEditorKit();
        editorPane.setEditorKit(kit);
        
        // Add some basic styling
        StyleSheet styleSheet = kit.getStyleSheet();
        styleSheet.addRule("body { font-family: sans-serif; }");
        styleSheet.addRule("code { background: #f0f0f0; padding: 2px 4px; }");
        styleSheet.addRule("pre { background: #f5f5f5; padding: 10px; }");
        
        JScrollPane scrollPane = new JScrollPane(editorPane);
        add(scrollPane, BorderLayout.CENTER);
    }
    
    public void appendMarkdown(String markdown) {
        // Convert basic Markdown to HTML
        String html = convertMarkdownToHTML(markdown);
        
        // Get current text and append new content
        String currentText = editorPane.getText();
        if (currentText.isEmpty()) {
            editorPane.setText(html);
        } else {
            editorPane.setText(currentText + html);
        }
        
        // Scroll to bottom
        editorPane.setCaretPosition(editorPane.getDocument().getLength());
    }
    
    private String convertMarkdownToHTML(String markdown) {
        // Basic Markdown to HTML conversion
        return markdown
                .replaceAll("\\*\\*(.*?)\\*\\*", "<strong>$1</strong>")  // Bold
                .replaceAll("\\*(.*?)\\*", "<em>$1</em>")                // Italic
                .replaceAll("`(.*?)`", "<code>$1</code>")                // Inline code
                .replaceAll("```([\\s\\S]*?)```", "<pre>$1</pre>")      // Code blocks
                .replaceAll("\\n", "<br>");                              // Newlines
    }
}
